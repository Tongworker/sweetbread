var polygonOptions = {
  strokeColor: "#525e64",
  strokeOpacity: 1,
  strokeWeight: 2,
  strokeStyle: "dashed",
  fillColor: "#e9edef",
  fillOpacity: 0.35
};

var editer, map = new AMap.Map("amap_polygons", {
  resizeEnable: true,
  zoom: 13 // 地图显示的缩放级别
});

var enableEdit = function(polygon) {
  map.setBounds(polygon.getBounds());
  //构造多边形编辑对象，并开启多边形的编辑状态
  editer = new AMap.PolyEditor(map, polygon);
  editer.open();

  $('#draw-note').hide();
  $('#edit-note').show();
}

// 在地图中添加ToolBar插件
var toolBar = new AMap.ToolBar()
map.addControl(toolBar);  
//在地图中添加MouseTool插件
var mouseTool = new AMap.MouseTool(map); 
AMap.event.addListener(mouseTool, "draw", function(draw) {
  mouseTool.close();
  enableEdit(draw.obj);
});

$(document).ready(function() {
  // 清除所有遮盖物
  $('.button-clear').click(function() {
    if (editer) editer.close();
    map.remove(map.getAllOverlays());
    mouseTool.polygon(polygonOptions);

    $('#draw-note').show();
    $('#edit-note').hide();
  });

  // 围栏对话框
  $('button[type="submit"]').on('click', function () {
    var list = [];
    // 坐标转换
    $.each(map.getAllOverlays('polygon'), function(n, o) {
      // 获取围栏坐标
      var points = [];
      $.each(o.getPath(), function(i, p) {
        points.push({lng: p.lng, lat: p.lat});
      });
      list.push(points);
    });
    
    // console.log(list);
    $.ajax( {
        url:'/home/index/okAdd',
        data:{list:list},
        type:'post',
        cache:false,
        success:function(data){
            console.log(data);
        },
        error:function(){
          alert('网络信息错误');
        }
    });


  });

  // 开启绘图
  mouseTool.polygon(polygonOptions);
  $('#draw-note').show();
});